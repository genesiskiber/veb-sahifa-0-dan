{% extends 'base.html' %}

{% block main %}
<div class="container mt-4">

    <h2>{{ product.title }}</h2>

    {% if product.image %}
        <img src="{{ product.image.url }}" alt="{{ product.title }}" style="max-width:300px;">
    {% endif %}

    <p class="mt-3">
        {{ product.description }}
    </p>

    <p>
        <strong>Narxi:</strong> {{ product.price }} $
    </p>

    <div class="d-flex gap-3 mt-4">

        <!-- UPDATE -->
        <a href="{% url 'product_update' product.pk %}" class="btn btn-warning">
            Tahrirlash
        </a>

        <!-- DELETE -->
        <a href="{% url 'product_delete' product.pk %}" class="btn btn-danger">
            O‘chirish
        </a>

        <!-- ORDER ADD/REMOVE -->
        <button class="btn btn-success" id="add-to-order">Mahsulotni qo‘shish</button>
        <button class="btn btn-secondary" id="remove-from-order">Mahsulotni kamaytirish</button>
        <span id="order-quantity"></span>
    </div>

<script>
document.getElementById('add-to-order').onclick = function() {
    fetch('{% url "add_to_order" product.pk %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Accept': 'application/json',
        },
    }).then(res => res.json()).then(data => {
        document.getElementById('order-quantity').innerText = 'Savat: ' + data.quantity;
    });
};
document.getElementById('remove-from-order').onclick = function() {
    fetch('{% url "remove_from_order" product.pk %}', {
        method: 'POST',
        headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Accept': 'application/json',
        },
    }).then(res => res.json()).then(data => {
        document.getElementById('order-quantity').innerText = '';
    });
};
</script>

</div>
{% endblock main %}
